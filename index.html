<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ふくびき券最短手順</title>
</head>
<body>
    <h1>ふくびき券最短手順(6手まで)</h1>
    
    <label for="input1">所持金:</label>
    <input type="number" id="input1" oninput="calculate()"><br><br>
    
    <label for="input2">薬草所持:</label>
    <input type="number" id="input2" oninput="calculate()"><br><br>
    
    <label for="input3">毒消し所持:</label>
    <input type="number" id="input3" oninput="calculate()"><br><br>
    
    <h2>結果</h2>
    <textarea id="result" rows="4" cols="50" readonly></textarea>
    
    <script>
        function step(first, buy, nani, yakunum, dokunum, gold, te, saishute) {
            nedan = [8,10,-4,-8]
            if (!first){
                if (buy) {
                    if (nani == 0) {yakunum += 1}
                    else {dokunum += 1}
                }
                else {
                    if (nani == 0) {yakunum -= 1}
                    else {dokunum -= 1}
                }
                
                gold -= nedan[nani + 2 + buy * -2]
                //合計の計算
                let digits = gold.toString().split('');
                let sum = digits.reduce((acc, digit) => acc + parseInt(digit), 0);
                if (sum % 5 == 0 && gold != 0 && buy) {
                    //console.log("HIT!")
                    if (saishute.length == 0 || te.length < saishute.length){
                        saishute = te
                    }
                }
            }
            if (te.length != 6){
                if (gold >= 8) {saishute = step(false, true, 0, yakunum, dokunum, gold, te.concat(0), saishute)}
                if (gold >= 10) {saishute = step(false, true, 1, yakunum, dokunum, gold, te.concat(1), saishute)}
        
                if (yakunum >= 1) {saishute = step(false, false, 0, yakunum, dokunum, gold, te.concat(2), saishute)}
                if (dokunum >= 1) {saishute = step(false, false, 1, yakunum, dokunum, gold, te.concat(3), saishute)}
            }
            return saishute
        }

        function calculate() {
            // 入力値を取得（空の入力には0を使用）
            let gold = parseInt(document.getElementById('input1').value) || 0;
            const yaku = parseInt(document.getElementById('input2').value) || 0;
            const doku = parseInt(document.getElementById('input3').value) || 0;

            saishute = step(true, true, -1, yaku, doku, gold, [], [])
            nedan = [8,10,-4,-8]

            resultText = ""
            
            if (saishute.length == 0) {resultText = "6手以内に見つけられなかった、もしくは値が不正です"}
            else {
                saishute.forEach(element => {
                    if (element == 0) {resultText += "\n買草"}
                    if (element == 1) {resultText += "\n買毒"}
                    if (element == 2) {resultText += "\n売草"}
                    if (element == 3) {resultText += "\n売毒"}
                    gold -= nedan[element]
                    resultText += " GOLD→" + gold
                })
                let digits = gold.toString().split('');
                let sum = digits.reduce((acc, digit) => acc + parseInt(digit), 0);
                resultText += " 各桁の合計→" + sum
            }

            document.getElementById('result').value = resultText;
        }
        
        // ページロード時に初期計算を行う
        window.onload = calculate;
    </script>
</body>
</html>

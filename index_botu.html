<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>スマホ・Switch版 ドラクエ２ふくびき券 簡単手順</title>
</head>
<body>
    <h1>スマホ・Switch版 ドラクエ２ふくびき券 簡単手順</h1>
    
    <label for="input1">所持GOLD:</label>
    <input type="number" id="input1" oninput="calculate()"><br><br>
    
    <label for="input2">薬草所持:</label>
    <input type="number" id="input2" oninput="calculate()"><br><br>
    
    <label for="input3">毒消し所持:</label>
    <input type="number" id="input3" oninput="calculate()"><br><br>
    
    <h2>結果</h2>
    <p>買おうとする</p>
    <textarea id="result1" rows="4" cols="50" readonly></textarea><br><br>
    <p>売ろうとする</p>
    <textarea id="result2" rows="4" cols="50" readonly></textarea><br><br>

    <p>
        ふくびき券を入手するためには<br>
        商品を買った後に<br>
        ・所持GOLDの各桁の合計が5の倍数()<br>
        ・受け取ったキャラの持ち物の数が7以下<br>
        であることが必要です<br>
        ※このプログラムでは後者の条件を考慮していません※<br>
        このプログラムは最大6回までの全探索です
    </p>
    <script>
        function step(first, buy, nani, yakunum, dokunum, gold, te, saishute, saishute2) {
            nedan = [8,10,-4,-8]
            if (!first){
                if (buy) {
                    if (nani == 0) {yakunum += 1}
                    else {dokunum += 1}
                }
                else {
                    if (nani == 0) {yakunum -= 1}
                    else {dokunum -= 1}
                }
                
                gold -= nedan[nani + 2 + buy * -2]
                //合計の計算
                let digits = gold.toString().split('');
                let sum = digits.reduce((acc, digit) => acc + parseInt(digit), 0);
                if (sum % 5 == 0 && gold != 0 && buy) {
                    //console.log("HIT!")
                    if (saishute[0].length == 0 || te.length < saishute[0].length){
                        saishute = [te,gold]
                        saishute2 = [te,gold]
                    }
                    else{
                        if (te.length < saishute[0].length && saishute[1] < gold){
                            saishute = [te,gold]
                        }
                        if (te.length < saishute2[0].length && saishute2[1] > gold){
                            saishute2 = [te,gold]
                        }
                    }
                }
            }
            if (te.length != 6){
                if (gold >= 8) {[saishute, saishute2] = step(false, true, 0, yakunum, dokunum, gold, te.concat(0), saishute, saishute2)}
                if (gold >= 10) {[saishute, saishute2] = step(false, true, 1, yakunum, dokunum, gold, te.concat(1), saishute, saishute2)}
        
                if (yakunum >= 1) {[saishute, saishute2] = step(false, false, 0, yakunum, dokunum, gold, te.concat(2), saishute, saishute2)}
                if (dokunum >= 1) {[saishute, saishute2] = step(false, false, 1, yakunum, dokunum, gold, te.concat(3), saishute, saishute2)}
            }
            return [saishute, saishute2]
        }

        function calculate() {
            // 入力値を取得（空の入力には0を使用）
            let gold = parseInt(document.getElementById('input1').value) || 0;
            const yaku = parseInt(document.getElementById('input2').value) || 0;
            const doku = parseInt(document.getElementById('input3').value) || 0;

            let gold2 = gold
            temp = step(true, true, -1, yaku, doku, gold, [], [[],0], [[],0],)
            saishute = temp[0]
            saishute2 = temp[1]
            nedan = [8,10,-4,-8]

            resultText = ""
            
            if (saishute[0].length == 0) {resultText = "6手以内に見つけられなかった、もしくは値が不正です"}
            else {
                saishute[0].forEach(element => {
                    if (element == 0) {resultText += "\n買草"}
                    if (element == 1) {resultText += "\n買毒"}
                    if (element == 2) {resultText += "\n売草"}
                    if (element == 3) {resultText += "\n売毒"}
                    gold -= nedan[element]
                    resultText += " GOLD→" + gold
                })
                let digits = gold.toString().split('');
                let sum = digits.reduce((acc, digit) => acc + parseInt(digit), 0);
                resultText += " 各桁の合計→" + sum
                resultText = resultText.substr(1)
            }

            document.getElementById('result1').value = resultText;




            resultText = ""
            
            if (saishute2[0].length == 0) {resultText = "6手以内に見つけられなかった、もしくは値が不正です"}
            else {
                saishute2[0].forEach(element => {
                    if (element == 0) {resultText += "\n買草"}
                    if (element == 1) {resultText += "\n買毒"}
                    if (element == 2) {resultText += "\n売草"}
                    if (element == 3) {resultText += "\n売毒"}
                    gold2 -= nedan[element]
                    resultText += " GOLD→" + gold2
                })
                let digits = gold2.toString().split('');
                let sum = digits.reduce((acc, digit) => acc + parseInt(digit), 0);
                resultText += " 各桁の合計→" + sum
                resultText = resultText.substr(1)
            }

            document.getElementById('result2').value = resultText;
        }
        
        // ページロード時に初期計算を行う
        window.onload = calculate;
    </script>
</body>
</html>
